<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beansolid - 배송정보 입력</title>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>
<body>
    <div>
        <h3>주문 상품</h3>
        <table border="1" style="border-collapse: collapse; width: 100%;">
            <thead>
                <tr>
                    <th>도서명</th>
                    <th>수량</th>
                    <th>가격</th>
                    <th>포장 옵션</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="item : ${items}">
                    <td th:text="${item.title}"></td>
                    <td th:text="${item.quantity}"></td>
                    <td th:text="${item.price} + '원'"></td>
                    <td>
                        <select th:name="|wrapping_${itemStat.index}|" th:onchange="|updateWrappingId(${itemStat.index}, this.value)|">
                            <option value="" selected>포장 안함</option>
                            <option value="1">일반 포장</option>
                            <option value="2">선물 포장</option>
                            <option value="3">고급 포장</option>
                        </select>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <form th:action="@{/orders}" method="post">
        <th:block th:each="item : ${items}">
            <input type="hidden" th:name="|orderItems[${itemStat.index}].bookId|" th:value="${item.bookId}">
            <input type="hidden" th:name="|orderItems[${itemStat.index}].quantity|" th:value="${item.quantity}">
            <input type="hidden" th:name="|orderItems[${itemStat.index}].price|" th:value="${item.price}">
            <input type="hidden" th:name="|orderItems[${itemStat.index}].wrappingId|" value="">
        </th:block>


        <div>
            <label for="receiverName">받는 분</label>
            <input type="text" id="receiverName" name="receiverName" placeholder="이름을 입력하세요" required>
        </div>

        <div>
            <label for="receiverPhoneNumber">휴대폰번호</label>
            <input type="text" id="receiverPhoneNumber" name="receiverPhoneNumber" placeholder="연락처를 입력하세요" required>
        </div>

        <div>
            <label for="zipCode">우편번호</label>
            <input type="text" id="zipCode" name="zipCode" placeholder="우편번호를 선택하세요" readonly required>
            <button type="button" onclick="searchAddress()">우편번호 찾기</button>
        </div>

        <div>
            <label for="baseAddress">주소</label>
            <input type="text" id="baseAddress" name="baseAddress" placeholder="주소를 선택하세요" readonly required>
        </div>

        <div>
            <label for="detailAddress">상세주소</label>
            <input type="text" id="detailAddress" name="detailAddress" placeholder="상세 주소를 입력하세요">
        </div>

        <div>
            <label for="requestedDeliveryDate">배송 희망일</label>
            <input type="date" id="requestedDeliveryDate" name="requestedDeliveryDate">
        </div>

        <button type="submit">다음 단계</button>
    </form>
    <script>
        function searchAddress() {
            new daum.Postcode({
                oncomplete: function(data) {
                    document.getElementById('zipCode').value = data.zonecode;
                    document.getElementById('baseAddress').value = data.address;

                    document.getElementById('detailAddress').focus();
                }
            }).open();
        }

        function updateWrappingId(index, wrappingId) {
            const hiddenInput = document.querySelector(`input[name="orderItems[${index}].wrappingId"]`);
            if (hiddenInput) {
                hiddenInput.value = wrappingId;
            }
        }
    </script>
</body>
</html>